<table class="min-w-full divide-y divide-gray-200 overflow-x-auto">
    <thead class="bg-gray-50">
        <tr>
            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                Usuario
            </th>
            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                Informacion
            </th>
            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                Status
            </th>
               <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                Cambiar status
            </th>
            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                Role
            </th>
     
            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                Cambiar rol
            </th>
            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                Acciones
            </th>
        </tr>
    </thead>
    <tbody class="bg-white divide-y divide-gray-200">
        {{#each usersList}}
            <tr>
                <td class="px-6 py-4 whitespace-nowrap">
                    <div class="text-sm font-medium text-gray-900">{{email}}</div>
                
                </td>
                <td class="px-6 py-4 whitespace-nowrap">
                    <div class="flex items-center">
                        <div class="flex-shrink-0 h-10 w-10">
                            <img class="h-10 w-10 rounded-full" src={{avatar}} alt="">
                        </div>
                        <div class="ml-4">
                            <div class="text-sm font-medium text-gray-900">
                                {{firstName}} {{lastName}}
                            </div>
                            <div class="text-sm text-gray-500">
                                Creado: '{{createdAt}}
                            </div>
                        </div>
                    </div>
                </td>
                <td class="px-6 py-4 whitespace-nowrap">
                    <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-green-100 text-green-800">
                        {{enabled}}
                    </span>
                </td>
                <td class="px-6 py-4 whitespace-nowrap  text-sm font-medium">
                    <button class="text-indigo-600 hover:text-indigo-900">Activo</a>
                    <button class="ml-2 text-red-600 hover:text-red-900">Inactivo</a>
                </td>
                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                    {{role}}
                </td>
                <td class="px-6 py-4 whitespace-nowrap  text-sm font-medium">
                   <button class="text-indigo-600 hover:text-indigo-900" type="button" onclick="changeRolToUser(`{{email}}`,'admin')">Admin</button>
                   <button class="text-blue-300 hover:text-indigo-900"   type="button" onclick="changeRolToUser(`{{email}}`,'user')">User</button>
                   <button class="text-blue-300 hover:text-indigo-900"   type="button" onclick="changeRolToUser(`{{email}}`,'premium')">Premium</button>
                </td>
                <td class="px-6 py-4 whitespace-nowrap  text-sm font-medium">
                   <button class="text-indigo-600 hover:text-indigo-900" type="button" onclick="deleteUser(`{{email}}`)">Eliminar</button>
                 
                </td>
            </tr>
    {{/each}}

    </tbody>
</table>

<script>

    function changeRolToUser(userEmail,newRole){
        /* Hace la solicitud http correspondiente para cambiar el rol del userEmail al rol pasado por parametro....*/
        //console.log('Click en ',userEmail,newRole)
         fetch(`/api/users/rol`,{
            method: 'PUT',
             headers: {'Content-Type': 'application/json'},
             body: JSON.stringify({ email: userEmail,new_role: newRole })
        })
        .then( response => {
            if (response.ok){
                //SI la respuesta fue favorable tomo y uso los datos para le mensaje.
                response.json()
                .then( data => {

                    Swal.fire({
                        title: 'Cambio de rol exitoso !',
                        text: data.message,
                        icon: 'success',
                        confirmButtonText: 'Continuar',
                        allowOutsideClick: false, // No permitir cerrar al hacer clic fuera del diálogo
                        allowEscapeKey: false     // No permitir cerrar con la tecla Escape
                    }).then((swalResult)=>{
                             window.location.href = `/views/users`
                    })
                })
                .catch(

                )
            }
        })

    }


    function deleteUser(userEmail){
        //Hace la solicitud http correspondiente para borrar al userEmail correspondiente.
        //console.log('eliminar',userEmail)
         fetch(`/api/users`,{
            method: 'DELETE',
             headers: {'Content-Type': 'application/json'},
             body: JSON.stringify({ email: userEmail })
        })
        .then( response => {
            if (response.ok){
                //SI la respuesta fue favorable tomo y uso los datos para le mensaje.
                response.json()
                .then( data => {
                    Swal.fire({
                        title: 'Eliminacion de user exitosa !',
                        text: data.message,
                        icon: 'success',
                        confirmButtonText: 'Continuar',
                        allowOutsideClick: false, // No permitir cerrar al hacer clic fuera del diálogo
                        allowEscapeKey: false     // No permitir cerrar con la tecla Escape
                    }).then((swalResult)=>{
                             window.location.href = `/views/users`
                    })
                })
                .catch( 
                    
                )
            }
        })
    }
        
    



</script>